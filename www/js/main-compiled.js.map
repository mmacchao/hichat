{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main-compiled.js","sourcesContent":["/**\r\n * Created by 6396000799 on 2016/7/29.\r\n */\r\n\r\nconst socket = io.connect();\r\nconst vm = new Vue({\r\n    el: '#app',\r\n    data: {\r\n        wordColor: '#000', //输入的文字颜色\r\n        nickname: '',\r\n        beingSendMsg: '', //input输入框内容\r\n        welcome: 'connect to server...',\r\n        connect: false,\r\n        loginSuccess: false,\r\n        numbers: 0,\r\n        canShowEmojiList: false,\r\n        //所有对话信息\r\n        dialogs: [],\r\n    },\r\n    computed: {\r\n        emojiList() {\r\n            \"use strict\";\r\n            //初始化 emoji 表情包\r\n            let arr = [];\r\n            for(let i = 1; i < 70; i++) {\r\n                arr.push(`img/emoji/${i}.gif`);\r\n            }\r\n            return arr;\r\n        },\r\n    },\r\n    init() {\r\n\r\n        //监听socket的connect事件, 此事件触发表示连接已建立\r\n        socket.on('connect', () => { //connect属于非自定义事件\r\n            //连接到服务器后, 显示昵称输入框\r\n            this.connect = true;\r\n            this.welcome = 'get yourself a nickname :)';\r\n\r\n            //连接建立后使昵称框获得焦点\r\n            this.$nextTick(() => {\r\n                \"use strict\";\r\n                document.getElementById('nickname').focus();\r\n            });\r\n        });\r\n        socket.on('nickExisted', () => { //监听 用户名 是否重复事件\r\n            this.welcome = 'nickname is taken, choose another pls';\r\n        });\r\n        socket.on('loginSuccess', () => { //登陆成功事件\r\n            \"use strict\";\r\n            this.loginSuccess = true;\r\n            // console.log(document.querySelector('#inputMsg'))\r\n            document.querySelector('#inputMsg').focus();\r\n        });\r\n        socket.on('system', res => { //系统消息事件\r\n            \"use strict\";\r\n            res = JSON.parse(res);\r\n            let words = res.nickname + (res.msg == 'login' ? ' joined' : ' left');\r\n            // console.log(res.length)\r\n            this.numbers = res.length;\r\n            this.dialogs.push({name: 'system', time: new Date().toLocaleTimeString(), words: {words, img: '', emoji: ''}})\r\n        });\r\n        socket.on('newMsg', (nickname, words, color) => { //接收服务器推送的文字\r\n            \"use strict\";\r\n            //处理文字中的emoji图片\r\n            words = words.replace(/\\[emoji:\\s+(\\d+)]/g, ($0, $1) => {\r\n               return '<img src=\"img/emoji/' + $1 + '.gif\">';\r\n            });\r\n            console.log(words);\r\n            this.dialogs.push({name: nickname, time: new Date().toLocaleTimeString(), words: {words, img: '', emoji: '', color}});\r\n        });\r\n        socket.on('newImg', (user, img, color) => { //接收服务器推送的图片\r\n            \"use strict\";\r\n            console.log('newImg');\r\n            this.dialogs.push({name: user, time: new Date().toLocaleTimeString(), words: {words: '', img, emoji: '', color}});\r\n            console.log(img)\r\n        })\r\n    },\r\n    methods: {\r\n        //清屏\r\n        clearScreen() {\r\n            \"use strict\";\r\n            this.dialogs = [];\r\n        },\r\n\r\n        //单个emoji被点击\r\n        selEmoji(i) {\r\n            \"use strict\";\r\n            this.beingSendMsg += `[emoji: ${i+1}]`;\r\n            this.canShowEmojiList = false;\r\n        },\r\n\r\n        //emoji按钮点击\r\n        showEmojiList() {\r\n            \"use strict\";\r\n            this.canShowEmojiList = !this.canShowEmojiList;\r\n        },\r\n        submitNickname(e) {\r\n            console.log('sendname')\r\n            if(this.nickname.trim()) {\r\n                // console.log('login')\r\n                socket.emit('login', this.nickname.trim());\r\n            } else {\r\n                this.nickname = '';\r\n                // console.log(e.target.nodeName)\r\n                if(e.target.nodeName != 'INPUT') {\r\n                    e.target.previousElementSibling.focus();\r\n                } else {\r\n                    // console.log(e.target)\r\n                    console.log('enter')\r\n                    e.target.focus();\r\n                }\r\n            }\r\n        },\r\n        sendMsg(msg) {\r\n            this.beingSendMsg = '';\r\n            document.querySelector('#inputMsg').focus();\r\n            //信息不为空则发送\r\n            if(msg.trim()) {\r\n                // console.log('send');\r\n                socket.emit('send', msg, this.wordColor);\r\n                // console.log(this)\r\n                // console.log(this.wordColor)\r\n                msg = msg.replace(/\\[emoji:\\s+(\\d+)]/g, ($0, $1) => {\r\n                    return '<img src=\"img/emoji/' + $1 + '.gif\">';\r\n                });\r\n                this.dialogs.push({name: this.nickname, time: new Date().toLocaleTimeString(), words: {words: msg, img: '', emoji: '', color: this.wordColor}});\r\n            }\r\n        },\r\n        sendImage(e) {\r\n            \"use strict\";\r\n            if(e.target.files.length != 0) {\r\n                let file = e.target.files[0];\r\n                let reader = new FileReader();\r\n                if(!reader) {\r\n\r\n                }\r\n                let that = this;\r\n                reader.onload = function(e) {\r\n                    this.value = '';\r\n                    socket.emit('img', e.target.result, that.wordColor);\r\n                    // console.log(e.target.result);\r\n                    that.dialogs.push({name: that.nickname, time: new Date().toLocaleTimeString(), words: {words: '', img: e.target.result, emoji: '', color: that.wordColor}});\r\n                }\r\n                reader.readAsDataURL(file);\r\n            }\r\n        },\r\n    },\r\n    watch: {\r\n        nickname(newV) {\r\n            \"use strict\";\r\n            // console.log(newV);\r\n            if(!newV.trim()) {\r\n                this.welcome = 'get yourself a nickname :)';\r\n            }\r\n        },\r\n        dialogs() {\r\n            \"use strict\";\r\n            //将对话列表最后一条显示在屏幕上\r\n            this.$nextTick(() => {\r\n                if( document.querySelector('#msgList > li:last-child') != null) {\r\n                    document.querySelector('#msgList > li:last-child').scrollIntoView();\r\n                    //保存对话列表\r\n                    window.localStorage.setItem('msgList', JSON.stringify(this.dialogs));\r\n                }\r\n            });\r\n\r\n\r\n        },\r\n    },\r\n});\r\n\r\n//vm.dialogs初始化\r\nif(window.localStorage.getItem('msgList') != null) {\r\n    vm.dialogs = JSON.parse(window.localStorage.getItem('msgList'));\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":"/source/"}